\documentclass{patmorin}
\listfiles
\usepackage{pat}
\usepackage{paralist}
\usepackage[T1]{fontenc}
\usepackage[utf8]{inputenc}
\usepackage{bbm}  % needed for \mathbbm{1}
% \usepackage{logix}
\usepackage{halloweenmath}
\usepackage{stmaryrd}

\usepackage{todonotes}
\usepackage{tcolorbox}
\usepackage{booktabs}
\usepackage{multirow}
\usepackage{comment}

\usepackage{thm-restate}



\newenvironment{clmproof}{\noindent\emph{Proof of Claim:}}{\hfill\rule{1ex}{1ex}}

\usepackage[longnamesfirst,numbers,sort&compress]{natbib}

\usepackage[mathlines]{lineno}
\setlength{\linenumbersep}{2em}
% \linenumbers
% \rightlinenumbers
\linenumbers
\newcommand*\patchAmsMathEnvironmentForLineno[1]{%
 \expandafter\let\csname old#1\expandafter\endcsname\csname #1\endcsname
 \expandafter\let\csname oldend#1\expandafter\endcsname\csname end#1\endcsname
 \renewenvironment{#1}%
    {\linenomath\csname old#1\endcsname}%
    {\csname oldend#1\endcsname\endlinenomath}}%
\newcommand*\patchBothAmsMathEnvironmentsForLineno[1]{%
 \patchAmsMathEnvironmentForLineno{#1}%
 \patchAmsMathEnvironmentForLineno{#1*}}%
\AtBeginDocument{%
\patchBothAmsMathEnvironmentsForLineno{equation}%
\patchBothAmsMathEnvironmentsForLineno{align}%
\patchBothAmsMathEnvironmentsForLineno{flalign}%
\patchBothAmsMathEnvironmentsForLineno{alignat}%
\patchBothAmsMathEnvironmentsForLineno{gather}%
\patchBothAmsMathEnvironmentsForLineno{multline}%
}



% Taken from
% https://tex.stackexchange.com/questions/42726/align-but-show-one-equation-number-at-the-end
\newcommand\numberthis{\addtocounter{equation}{1}\tag{\theequation}}

\definecolor{brightmaroon}{rgb}{0.76, 0.13, 0.28}
\definecolor{linkblue}{rgb}{0, 0.337, 0.227}
\newcommand{\defin}[1]{\emph{\textcolor{brightmaroon}{#1}}}
\makeatletter
\def\mathcolor#1#{\@mathcolor{#1}}
\def\@mathcolor#1#2#3{%
  \protect\leavevmode
  \begingroup
    \color#1{#2}#3%
  \endgroup
}
\makeatother
\newcommand{\mathdefin}[1]{\mathcolor{brightmaroon}{#1}}
% \newcommand{\mathdefin}[1]{\color{brightmaroon}#1}}
\setlength{\parskip}{1ex}

% Document-specific commands and math operators
\DeclareMathOperator{\tw}{tw}
\DeclareMathOperator{\pw}{pw}
\DeclareMathOperator{\bw}{bw}
\DeclareMathOperator{\spn}{span}
\DeclareMathOperator{\dist}{dist}
\DeclareMathOperator{\depth}{depth}
\DeclareMathOperator{\pth}{path}


% \DeclareMathOperator{\deg}{deg}

\title{\MakeUppercase{\boldmath A Stubby Product Structure Theorem for Planar Graphs}}

%\title{\MakeUppercase{\boldmath Planar graphs are contained in $\tilde{O}(\sqrt{n})$-blowups of fans}}

%Fan-Partitions of Planar Graphs (and Beyond)  \newline by Local Sparsification and Volume-Preserving Embeddings}}

\author{
 Vida Dujmovi{\'c}\,\footnote{School of Computer Science and Electrical Engineering, University of Ottawa, Ottawa, Canada (\texttt{vida.dujmovic@uottawa.ca}). Research supported by NSERC and a University of Ottawa Research Chair.}
 \qquad
 % Gwena\"el Joret\footnote{D\'epartement d'Informatique, Universit\'e libre de Bruxelles, Belgium ({\tt gwenael.joret@ulb.be}). G.\ Joret is supported by the Belgian National Fund for Scientific Research (FNRS) and by the Australian Research Council.}
 % \qquad
 % Piotr Micek\footnote{Department of Theoretical Computer Science, Jagiellonian University, Krak√≥w, Poland (\texttt{piotr.micek@uj.edu.pl}). Research supported
 % the National Science Center of Poland under grant UMO-2018/31/G/ST1/03718 within the BEETHOVEN program.}
 % \qquad
 Pat Morin\footnote{School of Computer Science, Carleton University, Ottawa, Canada (\texttt{morin@scs.carleton.ca}). Research supported by NSERC and the Ontario Ministry of Research and Innovation.}
 % \qquad
 % David~R.~Wood\footnote{School of Mathematics, Monash University, Melbourne, Australia (\texttt{david.wood@monash.edu}). Research supported by the Australian Research Council.}
 }

\date{}


\begin{document}

\maketitle

\begin{abstract}
  We show that each $n$-vertex planar graph $G$ is isomorphic to a subgraph of the strong product of a graph $H$ of treewidth $3$, a cycle $C$ of length $O(\sqrt{n})$, and a clique $K_c$ of bounded size.  Symbolically, $G\subseteq H\boxtimes C\boxtimes K_c$. This is a variation of the Planar Graph Product Structure Theorem which asserts that $G\subseteq H\boxtimes P\boxtimes K_3$, where $P$ is a path with no non-trivial upper bound on its length.  To the best of our knowledge, this new theorem has no applications!
\end{abstract}

\section{Introduction}



\section{Background}

A \defin{layering} of a graph $G$ is a sequence of pairwise-disjoint subsets $\mathcal{L}:=L_0,\ldots,L_h$ of $V(G)$ such that $\bigcup_{j=0}^h L_i=V(G)$ and, for each edge $vw$ of $G$, $v\in L_i$ and $w\in L_j$ implies $|j-i|\le 1$.  For a non-empty subset $S\subseteq V(G)$, the \defin{span} of $S$ in $\mathcal{L}$ is $\spn(\mathcal{L},S):=1+\max\{i:S\cap L_i\neq\emptyset\}-\min\{j:S\cap L_i\neq\emptyset\}$.


For two graphs $G$ and $A$, an \defin{embedding} of $G$ into $A$ is an injective function $\varphi:V(G)\to V(A)$ such that $\varphi(v)\varphi(w)\in E(A)$ for each $vw\in E(G)$.  When $S$ is a subset of $V(G)$, we use the shorthand $\varphi(S):=\{\varphi(v):v\in S\}$.  In particular, when $vw$ is and edge of $G$, $\varphi(vw)$ is an edge of $A$.  When $G'$ is a subgraph of $G$ we use the shorthand $\varphi(G'):=A[\varphi(V(G'))]$.

We are particularly interested in embeddings into strong products.  Let $H$ be a graph and $P:=y_0,\ldots,y_{n-1}$ be a path and consider the graph $H\boxtimes P$.  For each $i\in[n]$, the vertex set $V(H)\times\{y_i\}$ is called the $i$th \defin{layer} of $H\boxtimes P$ and $\mathcal{L}_P:=\langle V(H)\times\{y_i\} \rangle_{i\in[n]}$ is a layering of $H\boxtimes P$ that we call the \defin{natural layering} of $H\boxtimes P$.

Let $\varphi:V(G)\to H\boxtimes P$ be an embedding of $G$ into $H\boxtimes P$. A vertex $x$ of $H$ is \defin{relevant} to $\varphi$ if there is at least one $(v,i)\in V(G)\times [n]$ such that $\varphi(v)=(x,y_i)$.  We may assume that every vertex of $H$ is relevant to $\varphi$ since, if some vertex $x$ is irrelevant, then $\varphi:V(G)\to (H-\{x\})\boxtimes P$ is an embedding of $G$ into $(H-\{x\})\boxtimes P$. The \defin{span} of a (relevant) vertex $x$ of $H$ is
\[
  \spn(\varphi,x):=\spn(\mathcal{L}_P, \varphi(V(G))\cap (\{x\}\times V(P)))
\]
In words, if $x$ has span $k$, then all appearances of $x$ in $\varphi(G)$ occur on at most $k$ consecutive layers of $H\boxtimes P$.  The \defin{span} $\spn(\varphi)$ of $\varphi$ is the minimum value $k$ such that each (relevant) vertex of $H$ has span at most $k$.  Let $\mathdefin{C_k}$ denote a cycle of length of $k$.

\begin{lem}
  Let $G$ and $H$ be graphs and let $P$ be a path.  If there exists an embedding of $G$ into $H\boxtimes P$ with span at most $k$, then there exists an embedding of $G$ into $H\boxtimes C_k$.
\end{lem}

\begin{proof}
  Let $P:=y_0,\ldots,y_{n-1}$ and let $C_k:=y'_0,\ldots,y'_{k-1}$.  For each $v\in V(G)$, if $(x,y_i):=\varphi(v)$ then set $\rho(v):=(x,y'_{i\bmod k})$.  Since $\varphi$ is an injective function and has span $k$, $\rho:V(G)\to V(H\boxtimes C_k)$ is an injective function. By definition, for each edge $(x_1,y_{a})(x_2,y_b)$ of $H\boxtimes P$,  $(x_1,y'_{a\bmod k})(x_2,y'_{b\bmod k})$ is an edge of $H\boxtimes C_k$.  In particular, for each edge $vw$ of $G$, $\varphi(vw)$ is an edge of $H\boxtimes P$, so $\rho(vw)$ is an edge of $H\boxtimes C_k$.  Thus, $\rho$ is an embedding of $G$ into $H\boxtimes C_k$.
\end{proof}

For any connected graph $G$ and any vertex $v_0$ of $G$, the sequence $\langle \{v\in V(G):\dist_G(v_0,v)=i\}\rangle_{i\in\N}$ is called the \defin{$v_0$-rooted BFS layering} of $G$.


Let $G$ be a graph.  A sequence $\mathcal{B}:=B_0,\ldots,B_{p-1}$ of non-empty pairwise-disjoint subsets of $V(G)$ whose union is $V(G)$ is called a \defin{blocked vertex insertion order} for $G$. Let $G$ be a plane graph, let $\mathcal{B}:=B_0,\ldots,B_{p-1}$ be a blocked vertex insertion order for $G$ and let $\mathcal{L}$ be a layering of $G$.   The pair $(\mathcal{B},\mathcal{L})$ is a called a \defin{QUACK}.  We say that  the QUACK $(\mathcal{B},\mathcal{L})$ is \defin{$(t,w)$-good} if it satisfies the following conditions:
\begin{compactenum}[({good}-a)]
  % \item $v_0\in V(G_0)$;
  % \item For each $i\in[p]$, $G_i$ is $2$-connected;
  \item For each $i\in[p]$, the vertices in $B_i$ are all contained in a single face $F_i$ of $G_{i-1}:=G[\bigcup_{j=0}^{i-1} T_i]$;
  % \item For each $i\in[p]$, $\spn(\mathcal{L},T_i)\le C\sqrt{n}$;
  \item For each $i\in[p]$ and each $j\in[h]$, $|B_i\cap L_j|\le w$;
  \item For each $i\in[p]$ and each face $F$ of $G_i:=G[\bigcup_{j=0}^i B_i]$, the index set $I(F):=\{j\in\{0,\ldots,i\}:V(F)\cap T_j\neq\emptyset\}$ has at most $t$ elements;
  % \item For each $i\in[p]$, each face $F$ of $G_i$, and each $j\in I(F)$,  the vertices in $V(F)\cap T_j$ appear consecutively on the boundary of $F$;
  % \item For each $i\in[p]$, each face $F$ of $G_i$, and each $j\in I(F)$, $\spn(\mathcal{L},V(F)\cap T_j)\le c\sqrt{n}$.
\end{compactenum}

\begin{lem}\label{tw_good_quack}
  If an $n$-vertex plane graph $G$ has a $(t,w)$-good quack, then there exists a graph $H$ of treewidth at most $t$, a path $P:=y_0,\ldots,y_{n-1}$, and an embedding $\varphi$ of $G$ into $(H\boxtimes K_w)\boxtimes P$ such that
  \begin{compactenum}[(i)]
    \item for each $i\in[p]$, there exists $x\in V(H)$ such that $\varphi(B_i)\subseteq V(\{x\}\boxtimes K_w)\times V(P)$; and
    \item for each $j\in[j]$, $\varphi(L_j)\subseteq V(H\boxtimes K_w)\times\{y_j\}$;
  \end{compactenum}
\end{lem}

\begin{proof}
  Copy from linear-time algorithm paper.
\end{proof}

The QUACK $(\mathcal{B},\mathcal{L})$ is $(t,w,k)$-good if it is $(t,w)$-good and,
\begin{compactenum}[({good-}a)]\setcounter{enumi}{3}
  \item for each $i\in[p]$, $\spn(\mathcal{L},B_i)\le k$.
\end{compactenum}

\begin{lem}
  If a plane graph $G$ has a $(t,w,k)$-good quack, then there exists a graph $H$ of treewidth at most $t$, a path $P$, and an embedding $\varphi:V(G)\to (H\boxtimes K_w)\boxtimes P$ such that $\spn(\varphi)\le k$.
\end{lem}

\begin{proof}
  Follows immediately from properties (i) and (ii) of \cref{tw_good_quack}.
\end{proof}





% A sequence $L_0,\ldots,L_h$ of vertex subsets of $G$ is a \defin{BFS layering} of $G$ if it is a $v_0$-rooted BFS layering of $G$ for some vertex $v_0$ of $G$.

\begin{thm}\label{three_w_csqrtn_quack}
  There exists a real number $c>0$ such that, for every integer $n\ge 3$, every $n$-vertex triangulation $G$ has $(3,w,c\sqrt{n})$-good quack.
\end{thm}


The proof of \cref{three_w_csqrtn_quack} makes use of the following lemma, whose proof is the subject of \cref{crux_section}.

\begin{lem}\label{awesome_path}
  There exists constants $\alpha,\beta>0$ such that, for any $n\ge 3$, the following is true.
  Let $G$ be an $n$-vertex triangulation and let $C$ be a cycle in $G$ whose boundary consists of an edge $vw$ of $G$, a vertex $\lambda$ of $G$, a shortest path $P_v$ from $v$ to $\lambda$ and a shortest path $P_w$ from $w$ to $\lambda$.  Let $G_C$ be the subgraph of $G$ induced by the vertices in $C$ and the vertices of $G$ in the interior of $C$.  Let $s$ and $t$ be any two vertices of $C$ with $\dist(s,\lambda)=\dist(t,\lambda)=:d$.  Then $G_C$ contains a path $Q$ with endpoints $s$ and $t$ such that, for each $i\in\N$,
    \[  |\{x\in V(Q):\dist_G(x,\lambda)=i\}| \le
      \begin{cases}
        0 & \text{if $i < d$} \\
        \alpha & \text{if $d\le i \le i+\beta\sqrt{n}$} \\
        0 & \text{if $i > \beta\sqrt{n}$} \\
      \end{cases}
    \]
\end{lem}

\begin{proof}[Proof of \cref{three_w_csqrtn_quack}]
  We will construct a  $(3,w,3\beta\sqrt{n})$-good quack $(\mathcal{B},\mathcal{L})$.
  Let $L_0$ be the three vertices on the outer face of $G$ and, for each $i\ge 0$, let $L_i:=\{v\in V(G):\dist_G(v,L_0)=i\}$. The result is a layering $\mathcal{L}:=L_0,\ldots,L_{h-1}$ of $G$. We will construct $\mathcal{B}:=B_0,\ldots,B_{p-1}$ iteratively, beginning with $B_0:=L_0$.  When constructing $B_i$ we will ensure that, in addition to the conditions imposed $(3,w,c\sqrt{n})$-goodness, $B_i$ satisfies the following structural invariants:
  \begin{compactenum}[({struct}-a)]
    \item $G_i:=\bigcup_{j=0}^i B_i$ is $2$-connected;
    % \item $\spn(\mathcal{L},B_i)\le C\sqrt{n}$;
    \item For each $i\in[p]$, each face $F$ of $G_i$, and each $j\in I(F)$,  the vertices in $V(F)\cap B_j$ appear consecutively on the boundary of $F$;
    \item For each $i\in[p]$, each face $F$ of $G_i$, and each $j\in I(F)$, $\spn(\mathcal{L},V(F)\cap B_j)\le 2\beta\sqrt{n}$.
  \end{compactenum}

  Clearly, the set $B_0$ satisifies (struct-a) and (struct-b). It also satisfies (struct-c) provided that $2\beta\sqrt{n} \ge \spn(\mathcal{L},B_0)=1$ which is satisfied for any $\beta\ge 1/2\sqrt{3}$.  The set $B_0$ also satsifies (good-a)--(good-c) and satisfies $\spn(\mathcal{L},B_0)\le 3\beta\sqrt{n}$.  We now assume that we have already constructed sets $B_0,\ldots,B_{i-1}$ satisfying the requirement of the lemma and show how to construct $B_i$.

  Let $F$ be a face of $G_{i-1}$ that contains at least one vertex of $G$ in its interior.  By (struct-a), $F$ is a cycle in $G$.  We first deal with the (hardest) case, in which $|I(F)|=3$ and then deal with the (degenerate) cases $|I(F)|\in\{1,2\}$.  Treat $F$ as a cycle.  By (struct-a) and (struct-b), the vertices of can be partitioned among three vertex-disjoint paths $P_0$, $P_1$, and $P_2$, each of which is contained in (the cycle) $F$ and such that, for each $\ell\in[3]$,  $V(P_i)\subseteq B_{j_\ell}$ for some $j_\ell\in\{0,\ldots,i\}$.

  Add a dummy vertex $v_0$ in the outer face of $G$ that is adjacent to the three vertices of $L_0$ and call the resulting $(n+1)$-vertex triangulation $G'$.
  Fix a shortest path tree $T$ of $G'$ rooted at $v_0$, so that $T$ is a spanning tree of $G'$ with $\dist_T(v,v_0)=\dist_{G'}(v,v_0)$ for each $v\in V(G)$.

  Let $G_F$ be the subgraph of $G$ induced by all vertices of $G$ in $F$ and all vertices of $G$ in the interior of the region bounded by $F$.  Since $F$ is an inner face of $G_{i-1}$, $G[L_0]$ is the outer face of $G$ and $v_0$ is in the outer face of $G$, each vertex $v\in V(G_F)$ has a $T$-ancestor in $V(F)$.  For each $v\in V(G_F)$ let $v'$ be the $T$-ancestor of $v$ in $V(F)$ that has maximum depth.   If $v'\in V(P_\ell)$, then define the \defin{colour} of $v$ to be $\ell$.  In this way, each vertex of $G_F$ is a assigned a colour from the set $[3]$.  Property (struct-b) and Sperner's Lemma imply that $G_F$ contains an inner face $\tau_i:=v_0v_1v_2$ for which the colour of $v_i$ is $\ell$, for each $\ell\in[3]$.  For each $\ell\in[3]$, let $Q_\ell:=\pth_T(v_\ell,v_\ell')$ be the path in $T$ from $v_\ell$ to the vertex $v_{\ell}'\in V(P_{\ell})$ whose colour determines that of $v_\ell$.

  The construction in \citet{dujmovic.joret.ea:planar} would, at this point, set $B_i:=\bigcup_{\ell=0}^2 V(Q_\ell-v_\ell')$.
  % (This is what \citet{dujmovic.joret.ea:planar} call a \defin{tripod}.)
  It is straightforward to verify that this choice of $B_i$ satisfies (good-a), (struct-a), and (struct-b).  By the choice of $\tau_i$ and $Q_0,Q_1,Q_2$, each face $F'$ of $G_i$ that is not a face of $G_{i-1}$ is contained in $F$ and avoids at least one of $P_0$, $P_1$, or $P_2$. Therefore, $F'$ avoids at least one of $B_{j_0}$, $B_{j_1}$ or $B_{j_2}$. Therefore $I(F')\subseteq \{j_0,j_1,j_2,i\}$ and does not contain at least one of $j_0$, $j_1$, or $j_2$, so $|I(F')|\le 3$, which ensures that $B_i$ satisfies (good-c) with $t=3$.  For any $j\in\N$, $|B_i\cap L_j|=\bigcup_{\ell=0}^2|V(Q_\ell)\cap L_j|\le 3$, so $B_i$ satisfies (good-b) with $w=3$.

  However, setting $B_i:=\bigcup_{\ell=0}^2 V(Q_\ell-v_\ell')$ could violate (good-c) and (struct-c), since there is no non-trivial upper bound on the length of the paths $Q_0$, $Q_1$, or $Q_2$.  We now explain the modifications needed to fix this.  First, observe that each of $Q_0$, $Q_1$, and $Q_2$ begins at a vertex of $\tau_i$.  Since $\tau_i$ is a clique, its vertices have $T$-depth in $\{d,d+1\}$ for some integer $d$. If each of $Q_0$, $Q_1$, and $Q_2$ contains no more than $2\beta\sqrt{n}$ vertices, then $\spn(\mathcal{L},\bigcup_{\ell=0}^2 V(Q_\ell-v_\ell'))\le 2\beta\sqrt{n}$, so it satisfies (good-c) and (struct-c). In this case, we set $B_i:=\bigcup_{\ell=0}^2 V(Q_\ell-v_\ell')$ as before.

  Otherwise, assume without loss of generality that $|V(Q_1)|=\max\{|V(Q_\ell)|:\ell\in[3]\}\ge 2\beta\sqrt{n}$.  Since $v_1'\in V(P_1)$, (struct-c) implies that $\depth_T(v)\le \depth_T(v_1')+2\beta\sqrt{n}-1$ for each $v\in V(P_1)$.
  % Since there is an edge of $G$ from $P_0$ to $P_1$ and an edge of $G$ from $P_0$ to $P_2$, (struct-c) therefore implies that $\depth_T(v)\le \depth_T(v_1')+4\beta\sqrt{n}-2$ for each $v\in V(F)$. In particular, $\depth_T(v_1'),\depth_T(v_2')\le \depth_T(v_0')+4\beta\sqrt{n}-2$.

  % For each $\ell\in\{1,2,3\}$, $Q_\ell$ contains a vertex of depth $d\ge \depth_T(v_1')+c\sqrt{n}\ge \depth_T(v_1')+2(c/2)\sqrt{n}+1$, provided that $(c/2)\sqrt{n}+1\le c\sqrt{n}$, which is satisfied for all $c\ge\sqrt{3}$ and $n\ge 3$.  Therefore, for each $\ell\in\{1,2,3\}$, $Q_\ell$ contains a vertex $v_\ell''$ with $\depth_T(v_\ell'')=\depth_T(v_1')-1-\lceil (c/2)\sqrt{n}\rceil$.


  Let $Q_1'$ be obtained from $Q_1$ by removing all vertices of depth greater than $\depth_T(v_1')+3\beta\sqrt{n}$.
  % Our set $B_i$ will contain $V(Q_1')$. Of course, this is not enough, since $Q_0'$, $Q_1'$, and $Q_2'$ may not separate the interior of $F$ in a way that maintains (good-c) [or (struct-a)--(struct-c) for that matter].
  % From this point on all subscripts on $Q$, $Q'$, $P$, and $v$ are implicitly taken modulo $3$.
  For each $\ell\in[2]$, let $\lambda_\ell$ be the lowest-common $T$-ancestor of $v_\ell$ and $v_{\ell+1}$.
  Let $C_\ell$ be the cycle formed by the edge $v_\ell v_{\ell+1}$,  $\pth_T(v_\ell,\lambda_\ell)$ and $\pth_T(v_{\ell+1}\lambda_\ell)$\todo{Define this notation}.

  For each $z\in\{1,2\}$ and $\ell\in[2]$, let $v_\ell^{(z)}$ be the $T$-ancestor of $v_\ell$ of $T$-depth $\depth_T(v_0)+\lceil z\beta\sqrt{n}\rceil$.  Note that $v_\ell^{(z)}$ is well-defined since $\depth_T(v_\ell)\ge d \ge \depth_T(v_0)+2\beta\sqrt{n}$.
  By \cref{awesome_path}, there exists a path $R^{(z)}_\ell$ from $v^{(z)}_\ell$ to $v^{(z)}_{\ell+1}$ in  $G_{C_\ell}$\todo{Define this notation} whose vertices have depths in the interval
   \begin{equation}
      \depth_T(v^{(z)}_\ell),\depth_T(v^{(z)}_\ell)+\beta\sqrt{n}-1]
      \subseteq[\depth_T(v_0)+\lceil z\beta\sqrt{n}\rceil,\depth_T(v_0)+ (z+1)\beta\sqrt{n}] \label{face_span}
   \end{equation}
   and that contains at most $\alpha$ vertices from each layer in $\mathcal{L}$.

  Observe that $S^{(z)} := R^{(z)}_{0}\cup R^{(z)}_{1}$ is a path in $G$ with endpoints $v^{(z)}_{0}$ and $v^{(z)}_{1}$ that contains $v^{(z)}_\ell$ in its interior.  Let $X^{(z)}$ be the vertex set of the component of $S^{(z)}-V(F)$ that contains $v^{(z)}_1$.
  We set
  \[
     B_i := V(Q'_1)\cup X^{(1)} \cup X^{(2)}
  \]
  This satisfies (good-c) because $S^{(2)}$ does not contain any vertices of $P_1$. It satisfies (good-b) for $w=2\alpha+1$. It satisfies (good-a) by construction. It satisfies (good-d) since all vertices in $B_i$ have depth at least $\depth_T(v_1')+1$ and (by \cref{face_span}) at most $\depth_T(v_1')+3\beta\sqrt{n}$.   It satisfies (struct-a) by construction.  It satisfies (struct-b) by construction.  It satisfies (struct-c) by \cref{face_span}.
\end{proof}



\section{Proof of \cref{crux_lemma}}
\label{crux_section}


\bibliographystyle{plainurlnat}
\bibliography{short_tripods}


\end{document}
